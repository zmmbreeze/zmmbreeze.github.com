<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>GAæºä»£ç é‡Œçš„å°æŠ€å·§ä¹‹cookieç¯‡</title>
    <meta name ="viewport" content ="initial-scale=1, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="./assets/blog.css" />
    <link rel="stylesheet" href="./assets/entry.css" />
    <link rel="stylesheet" href="./assets/highlight.css" />
</head>
<body>
<div class="main">
    <a class="back" href="./">MZhou's blog</a>
    <div class="entry">
        <h1 id="ga-cookie-">GAæºä»£ç é‡Œçš„å°æŠ€å·§ä¹‹cookieç¯‡</h1>
<blockquote>
<p>ä½œè€…å‰æ®µæ—¶é—´åœ¨åšç±»ä¼¼Google Analyticsï¼ˆä»¥ä¸‹ç®€ç§°GAï¼‰çš„ç¬¬ä¸‰æ–¹ç›‘æ§è„šæœ¬ã€‚æ‰€ä»¥å¯¹GAçš„å‰ç«¯ä»£ç åšè¿‡è°ƒç ”ï¼Œå¯¹GAçš„å‹ç¼©åä»£ç åšäº†ä¸€å®šç¨‹åº¦ä¸Šçš„<a href="https://gist.github.com/zmmbreeze/ddb4b3a619187b923dc2c009b4323a42">äººè‚‰ç¾åŒ–</a>ã€‚è¿™é‡Œç¾åŒ–çš„æ˜¯<a href="https://www.google-analytics.com/analytics.js">analytics.js</a>çš„j41ç‰ˆæœ¬ï¼Œæœ¬æ–‡æåˆ°çš„å°æŠ€å·§ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªç‰ˆæœ¬çš„jsã€‚</p>
</blockquote>
<p>cookieçš„æœ¬è´¨æ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ç«¯çš„ä¸€æ®µç®€å•æ•°æ®ï¼ˆå¤šä¸ªé”®å€¼å¯¹ï¼‰ï¼Œæµè§ˆå™¨ä¼šä»æœåŠ¡å™¨æ¥å—æˆ–è€…å‘é€ç»™æœåŠ¡å™¨cookieã€‚è¿™æ ·ä¾¿å¯ä»¥ä¸ºæ²¡æœ‰çŠ¶æ€çš„HTTPåè®®æä¾›äº†è®°å½•çŠ¶æ€ä¿¡æ¯çš„æ–¹æ³•ï¼ŒçŸ¥é“å¤šä¸ªä¸åŒçš„HTTPè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€ä¸ªæµè§ˆå™¨ã€‚</p>
<p>åœ¨æµè§ˆå™¨ä¸­cookieæ˜¯æ”¯æŒèŒƒå›´æœ€å¹¿çš„å­˜å‚¨æ•°æ®çš„æ‰‹æ®µäº†ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆä¸€èˆ¬éƒ½æ›¾ç»æˆ–å¤šæˆ–å°‘çš„ä½¿ç”¨è¿‡cookieæ¥å­˜å‚¨æ•°æ®æˆ–å˜é‡ã€‚æµè§ˆå™¨æä¾›äº†<code>document.cookie</code>è¿™ä¸ªæ¥å£æ¥å¢åˆ æ”¹æŸ¥cookieã€‚ä½†æ˜¯åªèƒ½ä¸€æ¬¡è®¾ç½®ä¸€ä¸ªcookieã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// è®¾ç½®åä¸ºkeyçš„cookieï¼Œå€¼ä¸ºvalue</span>
<span class="hljs-built_in">document</span>.cookie = <span class="hljs-string">'key=value'</span>;
</code></pre>
<p>ä»£ç ä¸­çœç•¥äº†å…¶ä»–å¯é€‰é…ç½®ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie">MDNæ–‡æ¡£</a>ã€‚é€šè¿‡<code>domain</code>å’Œ<code>path</code>å‚æ•°ï¼Œå¯ä»¥å°†cookieè®¾ç½®åœ¨ä¸åŒçš„åŸŸåæˆ–è€…è·¯å¾„ä¸‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="lang-javascript">// è®¾ç½®åä¸ºkeyçš„cookieï¼Œå€¼ä¸ºvalue
document.<span class="hljs-variable">cookie =</span> '<span class="hljs-variable">A=</span><span class="hljs-number">1</span>;<span class="hljs-variable">path=</span>/;<span class="hljs-variable">domain=</span><span class="hljs-built_in">map</span>.baidu.com;';
</code></pre>
<p>ä¸Šé¢çš„ä»£ç åœ¨åŸŸå<code>map.baidu.com</code>ä¸‹çš„æ ¹è·¯å¾„ï¼ˆ<code>/</code>ï¼‰è®¾ç½®äº†cookie Açš„å€¼ä¸º<code>1</code>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>document.cookie</code>æ¥è·å–å½“å‰åŸŸåå’Œè·¯å¾„ä¸‹çš„æ‰€æœ‰cookieã€‚å½“æˆ‘ä»¬è®¿é—®<code>http://map.baidu.com</code>é¡µé¢æ—¶ï¼Œæ‰§è¡Œ<code>document.cookie</code>è·å¾—çš„ç»“æœæ˜¯<code>A=1</code>ã€‚</p>
<p>å¤§å®¶çŸ¥é“åŸŸåæ˜¯æœ‰çˆ¶åŸŸåå’Œå­åŸŸåçš„åŒºåˆ«çš„ï¼Œé”®åç›¸åŒçš„ä¸¤ä¸ªcookieå¯ä»¥åˆ†åˆ«è®¾ç½®åœ¨çˆ¶å­åŸŸåä¸Šã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="lang-javascript">document.<span class="hljs-variable">cookie =</span> '<span class="hljs-variable">A=</span><span class="hljs-number">1</span>;<span class="hljs-variable">path=</span>/;<span class="hljs-variable">domain=</span>.example.com;';
document.<span class="hljs-variable">cookie =</span> '<span class="hljs-variable">A=</span><span class="hljs-number">2</span>;<span class="hljs-variable">path=</span>/;<span class="hljs-variable">domain=</span>a.example.com;';
</code></pre>
<blockquote>
<p>é¡ºå¸¦æåˆ°ä¸€ä¸ªå†·é—¨çš„çŸ¥è¯†ç‚¹ï¼šä»¥<code>.</code>å¼€å¤´çš„åŸŸåè¡¨ç¤ºcookieè®¾ç½®åœ¨æ­¤åŸŸååŠå…¶å­åŸŸä¸Šï¼Œå¦åˆ™ä¸é€‚ç”¨äºå…¶å­åŸŸåã€‚ä¸è¿‡ä»<a href="http://www.ietf.org/rfc/rfc2965.txt">RFC 2965</a>æ ‡å‡†å¼€å§‹æµè§ˆå™¨ä¾¿ä¼šè‡ªåŠ¨ä¸ºdomainå±æ€§å€¼è‡ªåŠ¨æ·»åŠ ä¸€ä¸ª<code>.</code>å‰ç¼€ï¼Œæ‰€ä»¥åœ¨è®¾ç½®<code>domain</code>æ—¶åŠ ä¸åŠ <code>.</code>å‰ç¼€å·²ç»æ²¡æœ‰åŒºåˆ«äº†ã€‚ä½†æ˜¯ä¸ºäº†å…¼å®¹ä¸€äº›æ—§æµè§ˆè¿˜æ˜¯åŠ <code>.</code>ä¸ºå¥½ã€‚å¦å¤–å¦‚æœä¸è®¾ç½®<code>domain</code>æµè§ˆå™¨ä¼šé»˜è®¤ç”¨å½“å‰é¡µé¢çš„åŸŸåï¼Œè¿™æ—¶æµè§ˆå™¨ä¸ä¼šè‡ªåŠ¨æ·»åŠ <code>.</code>å‰ç¼€ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šåŒ…å«å­åŸŸäº†ã€‚</p>
</blockquote>
<p>åœ¨<code>.example.com</code>å’Œ<code>a.example.com</code>åŸŸåä¸‹é¢åˆ†åˆ«è®¾ç½®äº†<code>A=1</code>å’Œ<code>A=2</code>ä¸¤ä¸ªcookieã€‚æ­¤æ—¶æˆ‘ä»¬åœ¨<code>http://a.example.com</code>é¡µé¢ä¸‹æ‰§è¡Œ<code>document.cookie</code>å¾—åˆ°çš„ç»“æœæ˜¯ï¼š<code>A=1;A=2</code>ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://cloud.githubusercontent.com/assets/249872/18791619/0fe6206c-81e6-11e6-99c3-ab043142e750.png" alt="2"></p>
<p>å¼€å‘è€…æ˜¯æ²¡åŠæ³•ä»ç»“æœä¸­çŸ¥é“è¿™ä¸ªcookieæ˜¯è®¾ç½®åœ¨å“ªä¸ªåŸŸåä¸Šçš„ã€‚åŒæ ·è¿™ä¸ªæƒ…å†µä¹Ÿé€‚ç”¨äºä¸åŒçš„çˆ¶å­è·¯å¾„ä¸Šã€‚</p>
<p>è¿™åœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¯¹å¼€å‘è€…ä¸ä¼šæœ‰å½±å“ï¼Œä½†æ˜¯å¯¹äºGAæ¥è¯´ç¡®å®è‡´å‘½çš„ã€‚GAä¼šåœ¨å½“å‰ç½‘ç«™åŸŸåä¸‹é¢è®¾ç½®ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„cookie <code>_ga</code>ï¼Œç”¨äºæ ‡å¿—ç›¸åŒçš„ç”¨æˆ·ã€‚ç°åœ¨å¤§å‹çš„å…¬å¸éƒ½ä¼šåˆ†ä¸åŒçš„ç½‘ç«™åŸŸåï¼Œä¾‹å¦‚ï¼š<code>baidu.com</code>å’Œ<code>ditu.baidu.com</code>ã€‚å‡è®¾ç™¾åº¦ä½¿ç”¨äº†GAï½ é‚£ä¹ˆGAä¼šåˆ†åˆ«åœ¨ä¸¤ä¸ªåŸŸåä¸‹è®¾ç½®ä¸åŒçš„<code>_ga</code> cookieå€¼ï¼Œè¿™æ ·åœ¨<code>baidu.com</code>ä¸‹GAä¾¿ä¼šæ‹¿åˆ°ä¸¤ä¸ª<code>_ga</code>å€¼ã€‚ä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªï¼Œå‚»å‚»åˆ†ä¸æ¸…æ¥šã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGAåœ¨cookieçš„å€¼ä¸Šé¢åšæ–‡ç« ã€‚å¯ä»¥çœ‹åˆ°å†²çªåªä¼šå‘ç”Ÿåœ¨çˆ¶å­åŸŸåå’Œçˆ¶å­è·¯å¾„ä¸Šã€‚å› ä¸ºcookieæœ¬èº«çš„ç‰¹æ®Šæ€§ï¼šæ‰€æœ‰httpè¯·æ±‚ä¼šå¸¦ç€è¯¥åŸŸåä¸‹çš„æ‰€æœ‰cookieã€‚å¦‚æœcookieå€¼å¤ªé•¿å¤ªå¤šä¼šæ¶ˆè€—å¤ªå¤šå¸¦å®½ã€‚GAé€šè¿‡è®¡ç®—åŸŸåå’Œè·¯å¾„çš„â€œé•¿åº¦â€æ¥å”¯ä¸€æ ‡ç¤ºè¿™ä¸ªcookieæ‰€è®¾ç½®åœ¨çš„åŸŸåå’Œè·¯å¾„ã€‚è®¡ç®—â€œé•¿åº¦â€çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-javascript">/**
 * normalize <span class="hljs-built_in">domain</span>.
 * remove the first <span class="hljs-string">'.'</span> <span class="hljs-keyword">if</span> exist.
 * @<span class="hljs-keyword">param {</span>string<span class="hljs-keyword">}</span> <span class="hljs-built_in">domain</span> <span class="hljs-built_in">domain</span> <span class="hljs-constant">String</span>
 * @<span class="hljs-keyword">return {</span>string<span class="hljs-keyword">}</span> normalized <span class="hljs-built_in">domain</span>
 */
var normalizeDomain = function <span class="hljs-keyword">(domain) {</span>
    return <span class="hljs-built_in">domain</span>.indexOf(<span class="hljs-string">'.'</span>) === <span class="hljs-number">0</span> ? <span class="hljs-built_in">domain</span>.substr(<span class="hljs-number">1</span>) : <span class="hljs-built_in">domain</span>;
<span class="hljs-keyword">}</span>;

/**
 * get count of <span class="hljs-built_in">domain</span>.
 * getDomainCount(<span class="hljs-string">'qq.com'</span>) === <span class="hljs-number">2</span>
 * getDomainCount(<span class="hljs-string">'.qq.com'</span>) === <span class="hljs-number">2</span>
 * getDomainCount(<span class="hljs-string">'b.qq.com'</span>) === <span class="hljs-number">3</span>
 * getDomainCount(<span class="hljs-string">'e.qidian.qq.com'</span>) === <span class="hljs-number">4</span>
 *
 * @<span class="hljs-keyword">param {</span>string<span class="hljs-keyword">}</span> <span class="hljs-built_in">domain</span> <span class="hljs-built_in">domain</span> <span class="hljs-constant">String</span>
 * @<span class="hljs-keyword">return {</span>string<span class="hljs-keyword">}</span> normalized <span class="hljs-built_in">domain</span>
 */
var getDomainCount = function <span class="hljs-keyword">(domain) {</span>
    return normalizeDomain(<span class="hljs-built_in">domain</span>).split(<span class="hljs-string">'.'</span>).length;
<span class="hljs-keyword">}</span>;

/**
 * normalize <span class="hljs-built_in">path</span>
 * normalizePath(<span class="hljs-string">''</span>) === <span class="hljs-string">'/'</span>
 * normalizePath(<span class="hljs-string">'/'</span>) === <span class="hljs-string">'/'</span>
 * normalizePath(<span class="hljs-string">'/ping'</span>) === <span class="hljs-string">'/ping'</span>
 * normalizePath(<span class="hljs-string">'/ping/pv'</span>) === <span class="hljs-string">'/ping/pv'</span>
 * normalizePath(<span class="hljs-string">'ping/pv'</span>) === <span class="hljs-string">'/ping/pv'</span>
 * normalizePath(<span class="hljs-string">'ping/pv/'</span>) === <span class="hljs-string">'/ping/pv'</span>
 *
 * @<span class="hljs-keyword">param {</span>string<span class="hljs-keyword">}</span> <span class="hljs-built_in">path</span> <span class="hljs-built_in">path</span>
 * @<span class="hljs-keyword">return {</span>string<span class="hljs-keyword">}</span> <span class="hljs-built_in">path</span>
 */
var normalizePath = function <span class="hljs-keyword">(path) {</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">path) {</span>
        return <span class="hljs-string">'/'</span>;
    <span class="hljs-keyword">}</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">path</span>.length &gt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">path</span>.lastIndexOf(<span class="hljs-string">'/'</span>) === <span class="hljs-built_in">path</span>.length - <span class="hljs-number">1</span><span class="hljs-keyword">) {</span>
        // remove last <span class="hljs-string">'/'</span>
        <span class="hljs-built_in">path</span> = <span class="hljs-built_in">path</span>.substr(<span class="hljs-number">0</span>, <span class="hljs-built_in">path</span>.length - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">}</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">path</span>.indexOf(<span class="hljs-string">'/'</span>) !== <span class="hljs-number">0</span><span class="hljs-keyword">) {</span>
        // fill up first <span class="hljs-string">'/'</span>
        <span class="hljs-built_in">path</span> = <span class="hljs-string">'/'</span> + <span class="hljs-built_in">path</span>;
    <span class="hljs-keyword">}</span>

    return <span class="hljs-built_in">path</span>;
<span class="hljs-keyword">}</span>;

/**
 * get count of <span class="hljs-built_in">path</span>
 * getPathCount(<span class="hljs-string">''</span>) === <span class="hljs-number">1</span>
 * getPathCount(<span class="hljs-string">'/'</span>) === <span class="hljs-number">1</span>
 * getPathCount(<span class="hljs-string">'/ping'</span>) === <span class="hljs-number">2</span>
 * getPathCount(<span class="hljs-string">'/ping/pv'</span>) === <span class="hljs-number">3</span>
 * getPathCount(<span class="hljs-string">'ping/pv'</span>) === <span class="hljs-number">3</span>
 * getPathCount(<span class="hljs-string">'ping/pv/'</span>) === <span class="hljs-number">3</span>
 *
 * @<span class="hljs-keyword">param {</span>string<span class="hljs-keyword">}</span> <span class="hljs-built_in">path</span> <span class="hljs-built_in">path</span>
 * @<span class="hljs-keyword">return {</span>number<span class="hljs-keyword">}</span> count of <span class="hljs-built_in">path</span>
 */
var getPathCount = function <span class="hljs-keyword">(path) {</span>
    <span class="hljs-built_in">path</span> = normalizePath(<span class="hljs-built_in">path</span>);
    return <span class="hljs-built_in">path</span> === <span class="hljs-string">'/'</span> ? <span class="hljs-number">1</span> : <span class="hljs-built_in">path</span>.split(<span class="hljs-string">'/'</span>).length;
<span class="hljs-keyword">}</span>;

/**
 * <span class="hljs-constant">Get</span> <span class="hljs-built_in">domain</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">path</span> count string.
 *      domainCount + <span class="hljs-string">'-'</span> + pathCount + <span class="hljs-string">'$'</span>
 *
 * @<span class="hljs-keyword">param {</span><span class="hljs-constant">Window</span>=<span class="hljs-keyword">}</span> win window <span class="hljs-literal">context</span>.
 * @<span class="hljs-keyword">param {</span>string=<span class="hljs-keyword">}</span> <span class="hljs-built_in">domain</span> cookie <span class="hljs-built_in">domain</span>.
 * @<span class="hljs-keyword">param {</span>string=<span class="hljs-keyword">}</span> <span class="hljs-built_in">path</span> cookie <span class="hljs-built_in">path</span>.
 * @<span class="hljs-keyword">return {</span>string<span class="hljs-keyword">}</span> count string.
 */
var getDomainAndPathCount = function (win, <span class="hljs-built_in">domain</span>, <span class="hljs-keyword">path) {</span>
    win = win || window;

    var location = win.location;
    var pathCount = getPathCount(<span class="hljs-built_in">path</span> != null ? <span class="hljs-built_in">path</span> : location.pathname);
    var domainCount = getDomainCount(<span class="hljs-built_in">domain</span> != null ? <span class="hljs-built_in">domain</span> : location.<span class="hljs-built_in">hostname</span>);
    return domainCount + (pathCount &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">'-'</span> + pathCount : <span class="hljs-string">''</span>) + <span class="hljs-string">'-'</span>;
<span class="hljs-keyword">}</span>;
</code></pre>
<p>GAåœ¨è®¾ç½®cookieæ—¶åŠ ä¸Š<code>domain</code>å’Œ<code>path</code>çš„é•¿åº¦å‰ç¼€ï¼Œç„¶ååœ¨å–å‡ºcookieæ—¶éå†æ‰€æœ‰çš„åå­—ç›¸åŒçš„cookieæ‰¾åˆ°æŒ‡å®šåŸŸåå’Œè·¯å¾„ä¸‹çš„cookieã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Set cookie.
 *<span class="hljs-phpdoc"> @param</span> {string} key cookie name.
 *<span class="hljs-phpdoc"> @param</span> {string|number} value cookie value.
 *<span class="hljs-phpdoc"> @param</span> {Window=} win window context.
 *<span class="hljs-phpdoc"> @param</span> {number=} expires cookie expired time in milliseconds.
 *<span class="hljs-phpdoc"> @param</span> {string=} domain cookie domain.
 *<span class="hljs-phpdoc"> @param</span> {string=} path cookie path.
 *<span class="hljs-phpdoc"> @return</span> {boolean} success or not.
 */</span>
<span class="hljs-keyword">var</span> setCookie = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, value, win, expires, domain, path)</span> </span>{
    <span class="hljs-keyword">var</span> domainAndPathCount = getDomainAndPathCount(win, domain, path);
    value = value + <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span> setCookieRaw(key, domainAndPathCount + value.replace(/\-/g, <span class="hljs-string">'%2d'</span>), win, expires, domain, path);
};
<span class="hljs-comment">/**
 * Get cookie value.
 *
 *<span class="hljs-phpdoc"> @param</span> {string} key key name.
 *<span class="hljs-phpdoc"> @param</span> {Window=} win window context.
 *<span class="hljs-phpdoc"> @param</span> {string=} domain cookie domain.
 *<span class="hljs-phpdoc"> @param</span> {string=} path cookie path.
 *<span class="hljs-phpdoc"> @return</span> {string} cookie value.
 */</span>
<span class="hljs-keyword">var</span> getCookie = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, win, domain, path)</span> </span>{
    <span class="hljs-keyword">var</span> results = getCookieRaw(key, win);
    <span class="hljs-keyword">var</span> domainAndPathCount = getDomainAndPathCount(win, domain, path);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; results.length; i++) {
        <span class="hljs-keyword">var</span> r = results[i];
        <span class="hljs-keyword">if</span> (r.indexOf(domainAndPathCount) === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> r.slice(domainAndPathCount.length).replace(/%<span class="hljs-number">2</span>d/g, <span class="hljs-string">'-'</span>);
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
};
</code></pre>
<p>é­”é¬¼ğŸ‘¹è—äºç»†èŠ‚ã€‚GAå¯¹ç»†èŠ‚çš„è¿½æ±‚å¹¶æ²¡æœ‰æ­¢æ­¥äºæ­¤ã€‚cookieå<code>_ga</code>è™½ç„¶ä¸€èˆ¬å¾ˆå°‘æœ‰å¼€å‘è€…ä¼šç”¨åˆ°ï¼Œä½†æ˜¯ä¸æ€•ä¸€ä¸‡å°±æ€•ä¸‡ä¸€ã€‚å¦‚æœcookieå<code>_ga</code>å†²çªäº†å¹¶è¢«æ”¹å†™æˆäº†åˆ«çš„å€¼ï¼Œé‚£ä¹ˆGAå¾ˆå¯èƒ½ä¼šå‘é€ä¸€ä¸ªä¸ç¬¦åˆè¦æ±‚çš„å€¼è¿‡å»ã€‚è¿™å¯¹æœåŠ¡å™¨ç«¯è§£æä¹Ÿéå¸¸ä¸åˆ©ã€‚</p>
<p>GAåœ¨cookieçš„å€¼ä¹‹å‰åˆåŠ äº†å‰ç¼€<code>GA1.</code>ï¼Œä¸‹æ¬¡ä½¿ç”¨è¿™ä¸ªcookieæ—¶éƒ½ä¼šæ£€æŸ¥æ˜¯å¦å¸¦æœ‰<code>GA1.</code>å‰ç¼€ã€‚å¦‚æœä¸å­˜åœ¨å‰ç¼€åˆ™ç›´æ¥è¦†ç›–ç”Ÿæˆæ–°çš„ï¼Œå¦‚æœå­˜åœ¨åˆ™ç»§ç»­å¤ç”¨åŸcookieå€¼ã€‚</p>
<p>é™¤äº†é˜²æ­¢<code>_ga</code>è¢«å¼€å‘è€…è¦†ç›–ä¹‹å¤–ï¼ŒçŒœæƒ³è¿˜æœ‰ä¸€ä¸ªä½œç”¨ï¼Œå°±æ˜¯â€œç‰ˆæœ¬å·â€ã€‚å¤šä¸ªGAç‰ˆæœ¬ä¹‹é—´å¦‚æœ<code>_ga</code>çš„cookieå€¼ç”Ÿæˆç®—æ³•ä¸ä¸€æ ·éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥ä¾æ®<code>GA1.</code>å‰ç¼€æ¥åˆ¤æ–­åº”è¯¥æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Œé‡‡å–æ­£ç¡®çš„æ“ä½œã€‚</p>
<p>æ€»ç»“ä¸‹<code>_ga</code> cookieå€¼çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-javascript">// GA<span class="hljs-list">{version}</span>.<span class="hljs-list">{domainCount}</span>[-<span class="hljs-list">{pathCount}</span>].<span class="hljs-list">{randomNumber}</span>.<span class="hljs-list">{time}</span>
// pathæ˜¯<span class="hljs-string">'/'</span>æ—¶
document.cookie = <span class="hljs-string">'_ga=GA1.3.494346849.1446193077'</span>;
// æ²¡æœ‰pathæ—¶
document.cookie = <span class="hljs-string">'_ga=GA1.3-2.494346849.1446193077'</span>;
</code></pre>
<blockquote>
<p>ç»†å¾®ä¹‹å¤„è§çœŸç« :+1:</p>
</blockquote>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ol>
<li><a href="https://tools.ietf.org/html/rfc2109">RFC 2109</a></li>
<li><a href="http://www.ietf.org/rfc/rfc2965.txt">RFC 2965</a></li>
<li><a href="https://tools.ietf.org/html/rfc6265">RFC 6265</a></li>
<li><a href="http://stackoverflow.com/questions/9618217/what-does-the-dot-prefix-in-the-cookie-domain-mean">What does the dot prefix in the cookie domain mean?</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/document/cookie?redirectlocale=en-US&amp;redirectslug=DOM%2Fdocument.cookie">MDN document.cookie</a></li>
</ol>

    </div>

    <div class="info">
        <h1>MZhou&#39;s blog - Taste of life.</h1>
        <p>
            <a href="https://github.com/zmmbreeze" target="_blank">zmmbreeze</a> / <a href="https://twitter.com/zhoumm">@zhoumm</a>
        </p>
    </div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MP42BH"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MP42BH');</script>
    <!-- End Google Tag Manager -->
</div>
</body>
</html>
